.. _jdbc_connecting_to_crate:

=====================
Connecting to CrateDB
=====================

CrateDB >= 2.1 requires to connect using a valid database user. If you're using
the standard edition of CrateDB, you can only use the predefined ``crate``
user. If you're using the enterprise edition, see `User Management`_ on
information how to add and remove users.

In JDBC, the database user can be passed via the ``user`` key JDBC URL or
:ref:`jdbc_connection_properties`.

.. rubric:: Table of Contents

.. contents::
   :local:

JDBC Driver Class
=================

A connection can be established using ``DriverManager.getConnection()``
method, e.g.::

    Connection conn = DriverManager.getConnection("crate://localhost:5432/");

The driver class is ``io.crate.client.jdbc.CrateDriver``.

JDBC URL Format
===============

With JDBC, a database is represented by a URL (Uniform Resource Locator).
With CrateDB, this takes the following form::

    [jdbc:]crate://<host>:<psql-port>[,<host>:<psql-port> , ...]/
        [?propertyName1=propertyValue1[&propertyName2=propertyValue2]...]

.. note::

    The pair or list of <host>:<psql-port> pairs must always end with trailing
    slash.

The ``jdbc:`` prefix is optional. For example. To connect to a single server
the following two formats are both allowed::

    crate://localhost:5432/

::

    jdbc:crate://localhost:5432/


In order to connect to multiple servers multiple ``<host>:<psql-port>``
pairs can be specified by delimit them using a comma::

    crate://host1.example.com:5432,host2.example.com:5432/


To specify a schema, the ``setSchema`` method must be explicitly called on
the connection. If no schema is provided, the ``doc`` default schema will be
used:

.. code-block:: java

    Connection conn = DriverManager.getConnection("crate://localhost:5432/");
    conn.setSchema("foo");

.. note::

    Default schema support requires at least CrateDB 0.48.1. If the CrateDB
    server that is used has a version that is lower than 0.48.1 the specified
    schema will be ignored and the default ``doc`` schema will be used instead.


.. _jdbc_connection_properties:

CrateDB JDBC Parameters
=======================

Parameters can be specified when connecting to CrateDB using the JDBC driver.
Here's an example that illustrates the use of paremters to establish an SSL
connection with the database superuser ``crate``.

.. code-block:: java

    Properties properties = new Properties();
    properties.put("user", "crate");
    properties.put("ssl", "true");
    Connection conn = DriverManager.getConnection("crate://localhost:5432/", properties);

In addition, connection parameters can be passed via the JDBC URL:

.. code-block:: java

    Connection conn = DriverManager.getConnection("crate://localhost:5432/?property1=value1&property2=value2");

.. NOTE::

   The CrateDB JDBC driver supports all of `the PostgreSQL JDBC driver
   parameters`_, though not all of them will make sense for CrateDB.

.. _the PostgreSQL JDBC driver parameters: https://jdbc.postgresql.org/documentation/94/connect.html

.. _User Management: https://crate.io/docs/crate/reference/en/latest/sql/administration/user_management.html
